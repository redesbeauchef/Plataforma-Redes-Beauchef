{% extends "main_app/base.html" %}

{% load static %}

{% block specific_css %}
    <link rel="stylesheet" type="text/css" href="{% static "css/style_II.css" %}"/>
    <link rel="stylesheet" type="text/css" href="{% static "css/responsive2.css" %}"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/css/select2.min.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="{% static "css/requerimientos.css" %}"/>
{% endblock specific_css %}

{% block header %}
    {% include "main_app/header2.html" %}
{% endblock header %}

{% block content %}
    <section class="demo-page padding-bottom-2x">
      <div class="container">

          <h1 class="text-primary">Formulario de Requerimiento de Empresas</h1>
          <hr>

          <form enctype="multipart/form-data" method="post">


            <input type='hidden' name='csrfmiddlewaretoken' value='8co4KfxBTR4wHky2jJpDQa4hqXAjMCT3' /> <div id="div_id_companieName" class="form-group"> <label for="id_companieName" class="control-label  requiredField">
                            Nombre Compañia<span class="asteriskField">*</span> </label> <div class="controls "> <input class="textinput textInput form-control" id="id_companieName" maxlength="50" name="companieName" type="text" /> </div> </div> <div id="div_id_companieDescription" class="form-group"> <label for="id_companieDescription" class="control-label  requiredField">
                            Breve Descripción<span class="asteriskField">*</span> </label> <div class="controls "> <textarea class="textarea form-control" cols="40" id="id_companieDescription" maxlength="5000" name="companieDescription" placeholder="Ingrese una breve descripción de su compañia para ser utilizada en nuestra página web y en la difusión (5000 caracteres máximo)" rows="10">
            </textarea> </div> </div> <div id="div_id_representantename" class="form-group"> <label for="id_representantename" class="control-label  requiredField">
                            Nombre de la persona de su empresa a cargo de la Feria<span class="asteriskField">*</span> </label> <div class="controls "> <input class="textinput textInput form-control" id="id_representantename" maxlength="30" name="representantename" type="text" /> </div> </div> <div id="div_id_representantecelular" class="form-group"> <label for="id_representantecelular" class="control-label  requiredField">
                            Celular de la persona de su empresa a cargo de la Feria<span class="asteriskField">*</span> </label> <div class="controls "> <input class="numberinput form-control" id="id_representantecelular" name="representantecelular" type="number" /> </div> </div> <div id="div_id_representantecorreo" class="form-group"> <label for="id_representantecorreo" class="control-label  requiredField">
                            Email de la persona de su empresa a cargo de la Feria<span class="asteriskField">*</span> </label> <div class="controls "> <input class="textinput textInput form-control" id="id_representantecorreo" maxlength="50" name="representantecorreo" type="text" /> </div> </div> <fieldset

                > <legend>Día de Asistencia</legend> <div
                class="col-md-4" > <div id="div_id_day_preference_1" class="form-group"> <label for="id_day_preference_1" class="control-label  requiredField">
                            Día de Participación<span class="asteriskField">*</span> </label> <div class="controls "> <select class="select form-control" id="id_day_preference_1" name="day_preference_1">
            <option value="" selected="selected">---------</option>
            <option value="1">Lunes (08/10/2018)</option>
            <option value="2">Martes (09/10/2018)</option>
            <option value="3">Miercoles (10/10/2018)</option>
            </select> </div> </div> </div>
            <div
                class="col-md-4"  style="display: none;"> <div id="div_id_day_preference_2" class="form-group"> <label for="id_day_preference_2" class="control-label ">
                            Día Preferencia 2
            </label> <div class="controls "> <select class="select form-control" id="id_day_preference_2" name="day_preference_2">
                <option value="" selected="selected">---------</option>
                <option value="1">Lunes (08/10/2018)</option>
                <option value="2">Martes (09/10/2018)</option>
                <option value="3">Miercoles (10/10/2018)</option>
                </select> </div> </div> </div>
                <div
    class="col-md-4"  style="display: none;"> <div id="div_id_day_preference_3" class="form-group"> <label for="id_day_preference_3" class="control-label ">
                Día Preferencia 3
            </label> <div class="controls "> <select class="select form-control" id="id_day_preference_3" name="day_preference_3">
                    <option value="" selected="selected">---------</option>
                    <option value="1">Lunes (08/10/2018)</option>
                    <option value="2">Martes (09/10/2018)</option>
                    <option value="3">Miercoles (10/10/2018)</option>
                    </select> </div> </div> </div> </fieldset>
                    <fieldset

    > <legend>Tipo de Stand</legend> <div
    class="col-md-6" > <div id="div_id_stand_type" class="form-group"> <label for="id_stand_type" class="control-label  requiredField">
                Tipo de Stand<span class="asteriskField">*</span> </label> <div class="controls "> <select class="select form-control" id="id_stand_type" name="stand_type">
                    <option value="0">---------</option>
                    <option value="1">Stand reducido (2m x 3m)</option>
                    <option value="2">Stand simple (3m x 3m)</option>
                    <option value="3">Stand especial 4 (4m x 3m)</option>
                    <option value="4">Stand especial 5 (5m x 3m)</option>
                    <option value="5">Stand doble (6m x 3m)</option>
                    </select> </div> </div> </div>
                    <div
    class="col-md-6" > <div id="div_id_require_stand" class="form-group"> <label for="id_require_stand" class="control-label  requiredField">
                ¿Utilizará Stand Propio o Stand Feria?<span class="asteriskField">*</span> </label> <div class="controls "> <select class="select form-control" id="id_require_stand" name="require_stand">
<option value="0" selected="selected">---------</option>
<option value="1">Stand Propio</option>
<option value="2">Stand Feria</option>
</select> </div> </div> </div> </fieldset>
<fieldset><legend hidden id='producer_legend'>Datos de la productora que instalará su stand propio.</legend><div
    class="col-md-4"  id="div_producerName" style="display: none;"> <div id="div_id_producerName" class="form-group"> <label for="id_producerName" class="control-label ">
                Nombre productora
            </label> <div class="controls "> <input class="textinput textInput form-control" id="id_producerName" maxlength="50" name="producerName" type="text" /> </div> </div> </div>
<div
    class="col-md-4"  id="div_producerSponsor" style="display: none;"> <div id="div_id_producerSponsor" class="form-group"> <label for="id_producerSponsor" class="control-label ">
                Persona de contacto de productora
            </label> <div class="controls "> <input class="textinput textInput form-control" id="id_producerSponsor" maxlength="50" name="producerSponsor" type="text" /> </div> </div> </div>
<div
    class="col-md-4"  id="div_producerPhone" style="display: none;"> <div id="div_id_producerPhone" class="form-group"> <label for="id_producerPhone" class="control-label ">
                Telefono de persona de contacto
            </label> <div class="controls "> <input class="numberinput form-control" id="id_producerPhone" name="producerPhone" type="number" /> </div> </div> </div>
<div
    class="col-md-4"  id="div_producerEmail" style="display: none;"> <div id="div_id_producerEmail" class="form-group"> <label for="id_producerEmail" class="control-label ">
                Email de persona de contacto
            </label> <div class="controls "> <input class="textinput textInput form-control" id="id_producerEmail" maxlength="50" name="producerEmail" type="text" /> </div> </div> </div>
</fieldset><fieldset

    > <legend>Preferencia de Stand en Layout</legend> <div><p> Para ver el layout de la Feria y los números de stand haga click en el siguiente botón: <button type='button' class='btn btn-primary btn-xs' data-toggle='modal' data-target='#Layout'>Ver Layout</button></p></div><div
    class="col-md-4" > <div id="div_id_stand_preference_1" class="form-group"> <label for="id_stand_preference_1" class="control-label  requiredField">
                Stand de Preferencia 1<span class="asteriskField">*</span> </label> <div class="controls "> <select class="select form-control" id="id_stand_preference_1" name="stand_preference_1">
<option value="" selected="selected">---------</option>
<option value="A">Stand A</option>
<option value="B">Stand B</option>
<option value="1">Stand 1</option>
<option value="2">Stand 2</option>
<option value="3">Stand 3</option>
<option value="4">Stand 4</option>
<option value="5">Stand 5</option>
<option value="6">Stand 6</option>
<option value="7">Stand 7</option>
<option value="8">Stand 8</option>
<option value="9">Stand 9</option>
</select> </div> </div> </div>
<div
    class="col-md-4" > <div id="div_id_stand_preference_2" class="form-group"> <label for="id_stand_preference_2" class="control-label ">
                Stand de Preferencia 2
            </label> <div class="controls "> <select class="select form-control" id="id_stand_preference_2" name="stand_preference_2">
<option value="" selected="selected">---------</option>
<option value="A">Stand A</option>
<option value="B">Stand B</option>
<option value="1">Stand 1</option>
<option value="2">Stand 2</option>
<option value="3">Stand 3</option>
<option value="4">Stand 4</option>
<option value="5">Stand 5</option>
<option value="6">Stand 6</option>
<option value="7">Stand 7</option>
<option value="8">Stand 8</option>
<option value="9">Stand 9</option>
</select> </div> </div> </div>
<div
    class="col-md-4" > <div id="div_id_stand_preference_3" class="form-group"> <label for="id_stand_preference_3" class="control-label ">
                Stand de Preferencia 3
            </label> <div class="controls "> <select class="select form-control" id="id_stand_preference_3" name="stand_preference_3">
<option value="" selected="selected">---------</option>
<option value="A">Stand A</option>
<option value="B">Stand B</option>
<option value="1">Stand 1</option>
<option value="2">Stand 2</option>
<option value="3">Stand 3</option>
<option value="4">Stand 4</option>
<option value="5">Stand 5</option>
<option value="6">Stand 6</option>
<option value="7">Stand 7</option>
<option value="8">Stand 8</option>
<option value="9">Stand 9</option>
</select> </div> </div> </div> </fieldset>
<fieldset

    > <legend>Cantidad de Almuerzos</legend> <p>Según el porte de su stand, tiene una cantidad máxima de entrevistadores y, por lo tanto, de almuerzos. Si desea agregar algún almuerzo extra, éste tendrá un costo adicional de 1UF.</br></br> La cantidad máxima de entrevistadores son las siguientes: </br> Stand 2x3: 2 almuerzos </br> Stand 3x3: 2 almuerzos  </br> Stand 4x3: 3 almuerzos </br> Stand 5x3: 4 almuerzos </br> Stand 6x3: 4 almuerzos </br> </br> A continuación, por favor indicar la cantidad de entrevistadores y de almuerzos normales y almuerzos vegetarianos para su empresa.</p><div
    class="col-md-8" > <div id="div_id_numeroentrevistadores" class="form-group"> <label for="id_numeroentrevistadores" class="control-label  requiredField">
                Numero de Entrevistadores<span class="asteriskField">*</span> </label> <div class="controls "> <input class="numberinput form-control" id="id_numeroentrevistadores" name="numeroentrevistadores" type="number" value="1" /> </div> </div> </div>
<div
    class="col-md-6" > <div id="div_id_lunch_number" class="form-group"> <label for="id_lunch_number" class="control-label  requiredField">
                Almuerzos Normales<span class="asteriskField">*</span> </label> <div class="controls "> <input class="numberinput form-control" id="id_lunch_number" name="lunch_number" type="number" value="0" /> </div> </div> </div>
<div
    class="col-md-6" > <div id="div_id_veggie_lunch_number" class="form-group"> <label for="id_veggie_lunch_number" class="control-label  requiredField">
                Almuerzos Vegetarianos<span class="asteriskField">*</span> </label> <div class="controls "> <input class="numberinput form-control" id="id_veggie_lunch_number" name="veggie_lunch_number" type="number" value="0" /> </div> </div> </div> </fieldset>
<fieldset

    > <legend>Detalle de Entrevista</legend> <p>Las entrevistas por defecto son individuales de 15 minutos. </br> Usted puede decidir otra dinámica de entrevistas, variando el tiempo o modalidad, lo cual tendrá un efecto en la cantidad de participantes que entrevistará al final del día. </br> Para esto, seleccione 'Otra Modalidad' en tipo de entrevista y contacte con su ejecutivo para la determinación de ésta.<div
    class="col-md-6" > <div id="div_id_tipoentrevista" class="form-group"> <label for="id_tipoentrevista" class="control-label  requiredField">
                Tipo entrevistas<span class="asteriskField">*</span> </label> <div class="controls "> <select class="select form-control" id="id_tipoentrevista" name="tipoentrevista">
<option value="" selected="selected">---------</option>
<option value="1">Entrevistas Individuales cada 15 minutos</option>
<option value="2">Otra Modalidad</option>
</select> </div> </div> </div>
    <div class="contador_cupos">
        <h4>
            Quedan
            &nbsp;<span id="cupos_restantes">24</span>&nbsp;
            cupos
        </h4>
    </div>
    <div class="container">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="jp_listing_heading_wrapper">
                <h2>Seleccionar carreras y ofertas correspondientes</h2>
            </div>
        </div>
    </div>
    <div class="jp_form_add_wrapper">
        <div class="form" id="form-req">
            <div class="container">
                <form entype="multipart/form-data" method="post" action="" onsubmit="" id="form-carreras">
                    <div class="select_carrera_row_wrapper">
                        <a href="#" class="borrar_fila">
                            <i class="fa fa-times"></i>
                            &nbsp;Eliminar
                        </a>
                        <div class="select_carrera_row_content">
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-sm-4">
                                        <div class="form-group">
                                            <label for="carrera_1">Carrera:</label>
                                            <select class="carrera form-control" id="carrera_1" name="carrera_1"
                                                    autocomplete="off">
                                                <option value="" disabled selected>Seleccionar carrera</option>
                                                {% for carrera_val in carreras %}
                                                    <option value="{{ carrera_val.pk }}">
                                                        {{ carrera_val }}
                                                    </option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="oferta_1">Ofertas:</label>
                                            <select class="oferta form-control" id="oferta_1" name="oferta_1[]"
                                                    multiple="multiple">
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-sm-8">
                                        <div id="cards_ofertas_1">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                <div class="jp_listing_right_bar_btn_wrapper">
                    <div class="jp_listing_right_bar_btn">
                        <ul style="margin-top: 0;">
                            <li style="margin-top: 20px;">
                                <a href="#" id="add_carrera_button">
                                    <i class="fa fa-plus-circle"></i>
                                    &nbsp;Agregar otra carrera
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="login_btn_wrapper register_btn_wrapper login_wrapper"
                     style="background-color: #fff; border-top: 1px solid #e9e9e9; border-bottom: 0; margin-top: 20px;">
                    <a href="#" class="btn btn-primary login_btn"> confirmar </a>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}

{% block specific_js %}

    <script src="{% static "js/jquery.magnific-popup.js" %}"></script>
    <script src="{% static "js/custom_II.js" %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.7/js/select2.min.js"></script>

    {# el javascript esta aqui porque se usan tags de django #}
    <script type="text/javascript">
        $(document).ready(function () {

            // se aplica select2 a los selects existentes
            $('select').select2();

            // json con los tipos de trabajo por carrera
            let ofertas_por_carrera = [
                {
                    plan: "Ninguno",
                    ofertas: []
                },
                {
                    plan: "Ingenería Civil en Computación",
                    ofertas: ['Práctica 1', "Práctica 2", "Memoria", "Part-Time"]
                },
                {
                    plan: "Ingeniería Civil Industrial",
                    ofertas: ['Práctica 1', "Práctica 2", 'Práctica 3', "Memoria", "Part-Time"]
                },
                {
                    plan: "Ingeniería Civil en Tranportes",
                    ofertas: ["Práctica 2", 'Práctica 3', "Memoria", "Part-Time"]
                },
                {
                    plan: "Ingeniería Civil Hidráulica",
                    ofertas: ["Práctica 2", 'Práctica 3', "Memoria", "Part-Time"]
                },
                {
                    plan: "Ingeniería Civil en Estructuras",
                    ofertas: ["Práctica 2", 'Práctica 3', "Memoria", "Part-Time"]
                },
                {
                    plan: "Ingeniería Civil Química",
                    ofertas: ['Práctica 1', "Práctica 2", 'Práctica 3', "Memoria", "Part-Time"]
                },
                {
                    plan: "Ingeniería Civil en Biotecnología",
                    ofertas: ['Práctica 1', "Práctica 2", 'Práctica 3', "Memoria", "Part-Time"]
                },
                {
                    plan: "Ingenería Civil Mecánica",
                    ofertas: ['Práctica 1', "Práctica 2", 'Práctica 3', "Memoria", "Part-Time"]
                },
                {
                    plan: "Ingeniería Civil Eléctrica",
                    ofertas: ['Práctica 1', "Práctica 2", 'Práctica 3', "Memoria", "Part-Time"]
                },
                {
                    plan: "Ingeniería Civil Matemática",
                    ofertas: ['Práctica 1', "Práctica 2", 'Práctica 3', "Memoria", "Part-Time"]
                },
                {
                    plan: "Ingeniería Civil de Minas",
                    ofertas: ['Práctica 1', "Práctica 2", 'Práctica 3', "Memoria", "Part-Time"]
                },
                {
                    plan: "Geología",
                    ofertas: ['Práctica 1', "Práctica 2", 'Práctica 3', "Memoria", "Part-Time"]
                },
                {
                    plan: "Magíster en Ciencias de Computación",
                    ofertas: ["Memoria", "Part-Time"]
                },
                {
                    plan: "Magíster en Tecnologías de Información",
                    ofertas: ["Memoria", "Part-Time"]
                },
                {
                    plan: "Magíster en Ciencias de la Ingeniería",
                    ofertas: ["Memoria", "Part-Time"]
                },
            ];

            // funcion para configurar los eventos (es una funcion para poder
            // aplicarla cada vez que se agregan nuevas filas)
            let set_events = () => {

                // cuando se selecciona una carrera se rellena el select de las
                // ofertas y se eliminan las que ya se hayan seleccionado
                $('.carrera').on('change', function () {
                    let num_carrera = $(this).attr('id').split("_")[1]; // numero identificador
                    let oferta = $('#oferta_' + num_carrera); // select de ofertas asociado
                    let cards_ofertas = $('#cards_ofertas_' + num_carrera); // cards asociadas
                    oferta.empty(); // se limpia el select de ofertas
                    cards_ofertas.empty(); // se limpian las cards

                    // lista de ofertas que puede tener la carrera
                    let ofertas = ofertas_por_carrera[$(this).val()].ofertas;

                    // por cada elemento en la lista se agrega la opcion correspondiente
                    $.each(ofertas, function (index, value) {
                        oferta.append($('<option/>', {
                            value: value,
                            text: value
                        }));
                    });
                });

                // cuando se seleccionan ofertas se agregan las cards
                $('.oferta').on('change', function () {
                    let num_oferta = $(this).attr('id').split("_")[1]; // numero identificador
                    let cards_ofertas = $('#cards_ofertas_' + num_oferta); // cards asociadas
                    cards_ofertas.empty(); // se limpian las cards

                    // para cada oferta se agrega una carta
                    $.each($(this).val(), function (index, value) {
                        let val = value.replace(/[^a-zA-Z0-9]/g, "").toLowerCase(); // se limpia el nombre

                        // se agrega la carta que corresponde
                        cards_ofertas.append(
                            '<div class="col-sm-3">\n' +
                            '    <div class="card">\n' +
                            '         <div class="card_heading">\n' +
                            '             <h4>' + value + '</h4>\n' +
                            '         </div>\n' +
                            '         <div class="card_body">\n' +
                            '             <input type="number" class="form-control" id="' + val + '_' + num_oferta +
                            '" name="' + val + '_' + num_oferta + '" min="0">\n' +
                            '         </div>\n' +
                            '    </div>\n' +
                            '</div>'
                        );
                    });

                    // agregar evento para actualizar el contador
                    $("input[type=number]").bind('keyup input', function () {
                        let total = 0;
                        $("input[type=number]").each(function () {
                            let val = parseInt($(this).val());
                            if (!val) {
                                val = 0;
                            }
                            total += val;
                        });
                        let restantes = 24 - total;
                        $('#cupos_restantes').text(restantes);
                    });
                });

                // boton para eliminar la fila
                $('.borrar_fila').on('click', function () {
                    $(this).parent().remove();
                    return false;
                });
            };

            set_events();

            let numero_de_filas = 1;

            // cada vez que se presiona el boton se agrega una fila
            $('#add_carrera_button').on('click', function () {
                numero_de_filas++;
                $('#form-carreras').append(
                    '<div class="select_carrera_row_wrapper">\n' +
                    '    <a href="#" class="borrar_fila">\n' +
                    '        <i class="fa fa-times"></i>\n' +
                    '        &nbsp;Eliminar\n' +
                    '    </a>\n' +
                    '    <div class="select_carrera_row_content">\n' +
                    '        <div class="container-fluid">\n' +
                    '            <div class="row">\n' +
                    '                <div class="col-sm-4">\n' +
                    '                    <div class="form-group">\n' +
                    '                        <label for="carrera_' + numero_de_filas + '">Carrera:</label>\n' +
                    '                        <select class="carrera form-control" id="carrera_' + numero_de_filas + '" name="carrera_' + numero_de_filas + '"\n' +
                    '                                autocomplete="off">\n' +
                    '                            <option value="" disabled selected>Seleccionar carrera</option>\n' +
                    {% for carrera_val in carreras %}
                        '                                <option value="{{ carrera_val.pk }}">\n'+
                        '                                    {{ carrera_val }}\n'+
                        '                                </option>\n'+
                    {% endfor %}
                    '                        </select>\n' +
                    '                    </div>\n' +
                    '                    <div class="form-group">\n' +
                    '                        <label for="oferta_' + numero_de_filas + '">Oferta:</label>\n' +
                    '                        <select class="oferta form-control" id="oferta_' + numero_de_filas + '" name="oferta_' + numero_de_filas + '[]"\n' +
                    '                                multiple="multiple">\n' +
                    '                        </select>\n' +
                    '                    </div>\n' +
                    '                </div>\n' +
                    '                <div class="col-sm-8">\n' +
                    '                    <div id="cards_ofertas_' + numero_de_filas + '">\n' +
                    '                    </div>\n' +
                    '                </div>\n' +
                    '            </div>\n' +
                    '        </div>\n' +
                    '    </div>\n' +
                    '</div>'
                );

                // es necesario volver a aplicar select2 y set_events para que se apliquen a la fila nueva
                $('select').select2();
                set_events();

                return false;
            });
        });
    </script>

{% endblock specific_js %}